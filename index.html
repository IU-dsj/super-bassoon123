<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
  <title>手机全屏签名</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
  <style>
    html,body{margin:0;height:100%;display:flex;flex-direction:column;font-family:Arial}
    #c{background:#fff;border:none;flex:1;cursor:crosshair}
    #bar{background:#222;color:#fff;display:flex;justify-content:center;gap:10px;padding:8px}
    button{padding:8px 14px;font-size:14px}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
</head>
<body>
  <canvas id="c"></canvas>
  <div id="bar">
    <button onclick="save()">保存并发送</button>
    <button onclick="clearCanvas()">清空</button>
  </div>

  <script>
    /* 画布大小 = 视口大小 */
    const cvs = document.getElementById('c');
    const ctx = cvs.getContext('2d');
    let drawing = false;

    function resize(){
      cvs.width  = window.innerWidth;
      cvs.height = window.innerHeight - document.getElementById('bar').offsetHeight;
      ctx.lineWidth = 3;
      ctx.lineCap = ctx.lineJoin = 'round';
      ctx.strokeStyle = '#000';
    }
    window.addEventListener('resize', resize);
    resize();

    /* 统一鼠标/触摸事件 */
    function getPos(ev){
      const rect = cvs.getBoundingClientRect();
      return {
        x: (ev.clientX || ev.touches[0].clientX) - rect.left,
        y: (ev.clientY || ev.touches[0].clientY) - rect.top
      };
    }
    ['mousedown','touchstart'].forEach(evt => cvs.addEventListener(evt, ev=>{
      ev.preventDefault();
      drawing = true;
      const {x,y} = getPos(ev);
      ctx.beginPath();
      ctx.moveTo(x, y);
    }));
    ['mousemove','touchmove'].forEach(evt => cvs.addEventListener(evt, ev=>{
      if(!drawing) return;
      ev.preventDefault();
      const {x,y} = getPos(ev);
      ctx.lineTo(x, y);
      ctx.stroke();
    }));
    ['mouseup','touchend'].forEach(evt => window.addEventListener(evt, ()=>drawing=false));

    /* 保存并发送 */
    function save(){
      const img = cvs.toDataURL('image/png');
      emailjs.init("GzWnI9_DZ731pr1NO");
      emailjs.send("service_ie5vkns", "template_0nerq9o", {
        date: new Date().toLocaleString(),
        image: img
      }).then(()=>alert('已发送邮箱'))
        .catch(err=>alert(err));
    }
    function clearCanvas(){
      ctx.clearRect(0,0,cvs.width,cvs.height);
    }
  </script>
</body>
</html>
