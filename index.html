function sendAll(){
  const img = page.toDataURL('image/png');
  const blob = dataURLtoBlob(img);

  const fd = new FormData();
  fd.append('image', blob);

  fetch('http://你的域名.com:3000/upload', {method:'POST', body:fd})
    .then(r=>r.json())
    .then(data=>{
      const link = data.url;
      // 可选：EmailJS 把下载链接发邮件
      emailjs.init("GzWnI9_DZ731pr1NO");
      emailjs.send("service_ie5vkns", "template_0nerq9o", {
        date: new Date().toLocaleString(),
        download_link: link
      });
    })
    .catch(err=>alert(err));
}

function dataURLtoBlob(dataURL){
  const [head, base64] = dataURL.split(',');
  const byteString = atob(base64);
  const mime = head.split(':')[1].split(';')[0];
  const ab = new ArrayBuffer(byteString.length);
  const ia = new Uint8Array(ab);
  for (let i = 0; i < byteString.length; i++) ia[i] = byteString.charCodeAt(i);
  return new Blob([ab], {type: mime});
}
