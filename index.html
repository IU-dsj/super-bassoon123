<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
  <title>微信全屏签名</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{height:100%;font-family:Arial}
    #c{
      display:block;
      width:100vw;          /* 占满屏幕宽度 */
      height:calc(100vh - 48px); /* 扣除底部按钮高度 48px */
      background:#fff;
      border:none;
      cursor:crosshair;
      touch-action:none;
    }
    #bar{
      height:48px;
      background:#222;
      color:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:20px;
    }
    button{
      padding:6px 12px;
      font-size:14px;
      border:none;
      border-radius:4px;
      background:#fff;
      color:#222;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
</head>
<body>
  <canvas id="c"></canvas>
  <div id="bar">
    <button onclick="save()">保存并发送</button>
    <button onclick="clearCanvas()">清空</button>
  </div>

  <script>
    const cvs = document.getElementById('c');
    const ctx = cvs.getContext('2d');
    let drawing = false;

    /* 自适应分辨率 */
    function resize(){
      cvs.width  = window.innerWidth;
      cvs.height = window.innerHeight - 48; /* 48px = 底部按钮高度 */
      ctx.lineWidth = 3;
      ctx.lineCap = ctx.lineJoin = 'round';
      ctx.strokeStyle = '#000';
    }
    window.addEventListener('resize', resize);
    resize();

    /* 统一鼠标/触摸事件 */
    function getPos(ev){
      const rect = cvs.getBoundingClientRect();
      return {
        x: (ev.clientX || ev.touches[0].clientX) - rect.left,
        y: (ev.clientY || ev.touches[0].clientY) - rect.top
      };
    }
    ['mousedown','touchstart'].forEach(evt => cvs.addEventListener(evt, ev=>{
      ev.preventDefault();
      drawing = true;
      const {x,y} = getPos(ev);
      ctx.beginPath();
      ctx.moveTo(x, y);
    }));
    ['mousemove','touchmove'].forEach(evt => cvs.addEventListener(evt, ev=>{
      if(!drawing) return;
      ev.preventDefault();
      const {x,y} = getPos(ev);
      ctx.lineTo(x, y);
      ctx.stroke();
    }));
    ['mouseup','touchend'].forEach(evt => window.addEventListener(evt, ()=>drawing=false));

    /* 保存并发送 */
    function save(){
      const img = cvs.toDataURL('image/png');
      emailjs.init("GzWnI9_DZ731pr1NO");
      emailjs.send("service_ie5vkns", "template_0nerq9o", {
        date: new Date().toLocaleString(),
        image: img
      }).then(()=>alert('已发送邮箱'))
        .catch(err=>alert(err));
    }
    function clearCanvas(){
      ctx.clearRect(0,0,cvs.width,cvs.height);
    }
  </script>
</body>
</html>
