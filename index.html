<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
  <title>海油工程2025签字</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
  <style>
    body{margin:0;font-family:Arial;background:#f5f5f5}
    #title{background:#003366;color:#fff;font-size:18px;font-weight:bold;text-align:center;padding:12px 0}
    #c{display:block;width:100%;height:100px;background:#fff;border:1px solid #ccc;cursor:crosshair;touch-action:none}
    #bar{background:#003366;display:flex;justify-content:center;gap:20px;padding:8px}
    button{padding:6px 12px;font-size:14px;border:none;border-radius:4px;background:#fff;color:#003366}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
</head>
<body>
  <div id="title">海油工程2025年职工拔河比赛服装签收表签字</div>
  <canvas id="c"></canvas>
  <div id="bar">
    <button onclick="save()">保存并发送</button>
    <button onclick="clearCanvas()">清空</button>
  </div>

  <script>
    const cvs = document.getElementById('c');
    const ctx = cvs.getContext('2d');
    let drawing = false;

    /* 自适应宽度，固定高度100px */
    function resize(){
      cvs.width  = window.innerWidth;
      cvs.height = 100;
      ctx.lineWidth = 3;
      ctx.lineCap = ctx.lineJoin = 'round';
      ctx.strokeStyle = '#000';
    }
    window.addEventListener('resize', resize); resize();

    function getPos(ev){
      const rect = cvs.getBoundingClientRect();
      return {x:(ev.clientX||ev.touches[0].clientX)-rect.left,y:(ev.clientY||ev.touches[0].clientY)-rect.top};
    }
    ['mousedown','touchstart'].forEach(evt=>cvs.addEventListener(evt,ev=>{
      ev.preventDefault(); drawing=true;
      const {x,y}=getPos(ev); ctx.beginPath(); ctx.moveTo(x,y);
    }));
    ['mousemove','touchmove'].forEach(evt=>cvs.addEventListener(evt,ev=>{
      if(!drawing) return;
      ev.preventDefault();
      const {x,y}=getPos(ev); ctx.lineTo(x,y); ctx.stroke();
    }));
    ['mouseup','touchend'].forEach(evt=>window.addEventListener(evt,()=>drawing=false));

    function save(){
      const img = cvs.toDataURL('image/png');
      emailjs.init("GzWnI9_DZ731pr1NO");
      emailjs.send("service_ie5vkns", "template_0nerq9o", {
        date: new Date().toLocaleString(),
        image: img
      }).then(()=>alert('已发送邮箱')).catch(err=>alert(err));
    }
    function clearCanvas(){ ctx.clearRect(0,0,cvs.width,cvs.height); }
  </script>
</body>
</html>
